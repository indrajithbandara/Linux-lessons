Исходное состояние:
 
Сервер   - находиться в работе.  На сервере запущен haproxy.
 
В исходно состоянии сервер слушает ip адрес 192.168.8.71
сконфигурированный при помощи network manager.  Keepalived выключен и
disabled.
 
Сервер proxy2.localdomain находится в резерве.  ip адрес
192.168.8.s82 сконфигурированный при помощи network manager.  Haproxy
включен и enabled. Keepalived выключен и disabled.
 
Firewalld на обоих серверах выключен и disabled
 
 
Переезд IP:
 
Шаг 1. Выключение haproxy на обоих серверах
(proxy.localdomain и proxy2.localdomain)
 
Шаг 2. Конфигурируем на proxy.localdomain через nmcli новый
ip - 192.168.8.81/23 (сохраняем, активируем соединение)
 
Шаг 3. Снимаем через nmcli на proxy.localdomain старый ip -
192.168.8.71 (сохраняем, активируем соединение)
 
Шаг 4.  Изменяем настройки Haproxy на  proxy2.localdomain (192.168.8.76) — изменяем ip адрес который слушает haproxy в файле /etc/haproxy/haproxy.cfg
 
Шаг 5. Включаем на proxy2.localdomain Haproxy (проверяем
наличие процесса, прослушивание портов, коннект к galera cluster через
web монитор)
 
Шаг 6. Включаем на обоих серверах keepalived (проверяем наличие процесса,
статус службы, прохождение vrrp трафика)
 
Шаг 7. Проверяем наличие на кластере виртуального ip 192.168.8.71.
Проверяем состояние нод
 
Шаг 8. Проверяем состояние Haproxy по новому ip (192.168.8.71)
 
Шаг 9. Переводим Keepalived на обоих серверах в enable.  Haproxy на
192.168.8.81 (бывший proxy.localdomain)  в disable
 
Шаг 10. Ещё раз проверяем состояние кластера (прослушивание виртуального
ip,  состояние нод,  доступ до galera кластера)
 
 
Финальное состояние:
 
proxy.localdomain - указывает на виртуальный ip keepalived
кластера.  В данный кластер входят 2 хоста - 192.168.8.81 и
192.168.8.82.  Мастер - 192.168.8.82.
 
На 192.168.8.81  haproxy выключен и в disabled на 192.168.8.82 включен
и в enabled.
 
Firewalld на обоих серверах выключен и disabled
